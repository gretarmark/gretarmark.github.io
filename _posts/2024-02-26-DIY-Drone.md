---
layout: post
title: DIY Drone
published: false
---

Creating your own drone from scratch presents a significant challenge. In this post, I will provide valuable information necessary for building your own drone, with a special focus on selecting components and developing your own flight controller software using STM32 technology. 


## Choosing the right components

* IMU sensor [1]: Internal Measurement Unit is needed.
  * BNO055: Is a smart 9-DOF that does the sensor fusion on its own, invented by Bosch. It has BSX algorithm built-in and can offer Euler angles and quaternions directly.
  * BMI270: Is said to be the best on the market (I read that on Google). It's widely used in flight controllers. UAV Tech in [6] goes over this one. I recommend buying the shuttle board "BMI270 Shuttle Board 3.0" which can be found in [www.mouser.com](https://eu.mouser.com/ProductDetail/Bosch-Sensortec/BMI270-Shuttle-Board-3.0?qs=Wj%2FVkw3K%252BMAJZNNlwTrTpw%3D%3D).
  * BMI160: Was a classic IMU sensor for flight controllers before BMI270 took over [6]. 
  * BMI088: Is an excellent solution for vibration robustness. If you will be moving into cold storage or hot to cool areas like indoors to outdoors, vice versa. This one is recommended from Bosch for drone applications.
  * MPU9250: Is not that good after some research on Google Search Engine.
  * MPU6050 (GY-521): GY-521 is a shuttle board that includes MPU6050 IMU sensor that consists of gyroscope and accelerometer. I2C up to 400kHz is used for communication, not capable with SPI.
  * MPU6000: Similar to MPU6050 but supports SPI up to 20MHz
  * STM32F411E-DISCO: The discovery board from STM32 includes gyroscope, accelerometer and magnetometer [www.st.com](https://estore.st.com/en/stm32f411e-disco-cpn.html). The accelerometer and the magnetometer are combined into one unit (ST MEMS LSM303DLHC or LSM303AGR) and the gyroscope is sepparated in another unit (ST MEMS L3GD20 or I3G4250D).
  * It is worth mentioning that IMU sensors in UAV's do not rely on magnetometers, only accelerometers and gyroscopes, and IMU sensors are mainly used to stabilize the drone, e.g. BMI270 includes only accelerometer and gyroscope. But when determining the direction of a UAV, one of the main methods is by using a compass which have a small magnetometer that helps them to detect the earth's magnetic field but they are not using the IMU for that. This allows them to determine which direction they are facing with respect to the magnetic north. Sometimes the IMU sensor is used to help determining the direction they are facing or a GPS which calculates their heading and direction. So we can say that drones use combination of sensors such as compasses, accelerometers, gyroscopes, and GPS technology to determine their direction, but use IMU to stabilize itself.  
* Barometer
  * BME280: Communication protocol is either I2C or SPI with sample rate up to 150Hz and has integrated filter to reduce noise. It's a temperature, humidity and pressure sensor. This sensor can be used to measure altitude of the drone. The pressure (or density) of the air changes with altitude so therefore we can measure the pressure using this sensor. We can use the Hypsometric Equation for this sensor
  * BMP388: Precision Barometric Pressure and Altimeter sensor with sample rate up to 200Hz if needed. This sensor is targeted towards drones and naviagion applications and is better than BME280.
* GPS or GNSS: Sensors that tells the drone its latitude, longitude and altitude as well as its velocity and its heading. We should choose a pretty good GPS, not a bad one since these measurements needs to be very accurate. When choosing a GPS you should focus on position accuracy, sample rate and GPS networks. World map of satellites is found in [10]. The more sattelites your GPS can connect to the more accurate your horizontal position accuracy is.
  * Adafruit Ultimate GPS with USB - 66 channel w/10Hz updates. This one can only connect to the US GPS network. 
  * Beitian BN220: GPS module TTL dual GPS Glonass navigation with flash + GPS passive antenna. 10Hz sampling rate. Multiple GPS networks. 2m horizontal accuracy.
  * GPS NEO-6M: 5Hz sample rate. Can only connect to the US GPS network. 5m horizontal position accuracy. 

## Connecting IMU to STM32 board

I decided to try the a IMU sensor called MPU6050 since I already had it in my toolbox, but I only recommend this one for a prototype. The MPU6050 is embedded on a shuttle board and uses I2C for communication. It can reach up to 400kHz, so it's pretty slow compared to other IMU sensors.

* VCC: The breakout board has a voltage regulator. Therefore, you can connect the board to 3.3V and 5V sources.
* GND
* SCL: Serial Clock Line of the I2C protocol.
* SDA: Serial Data Line of the I2C protocol.
* XDA: Auxiliary data => I2C master serial data for connecting the module to external sensors.
* XCL: Auxiliary clock => I2C master serial clock for connecting the module to external sensors.
* AD0: If this pin is LOW, the I2C address of the board will be 0x68. Otherwise, if the pin is HIGH, the address will be 0x69.
* INT: Interrupt digital output

![Fig 1]({{ site.baseurl }}/images/DIY_Drone/MPU6050_Connection.png "zero order"){:width=20%}  
**Figure 1: Connection of MPU6050 to STM32F407G Discovery Board.**

...post in progress...

#### References

[1] IMU [Link](https://surveygyaan.medium.com/sensors-used-in-drones-e6f29be61fb4#:~:text=Gyroscopes%20are%20versatile%20tool%20for,accelerometers%2C%20which%20measure%20linear%20acceleration.)

[2] MicWro Engr. YouTube. All sensors needed for a drone. [Link](https://www.youtube.com/watch?v=filjKFjQw4U)

[3] Adafruit. Article. Smart 9DOF IMU BNO055 [Link](https://www.adafruit.com/product/2472)

[4] STM32 IMU drone course. [Link](https://www.steppeschool.com/courses/stm32-hal-orientation-estimation)

[5] STM32 IMU drone course YouTube. [Link](https://www.youtube.com/watch?v=UEnWlSgGPiE)

[6] UAV Tech. Youtube. [Link](https://www.youtube.com/watch?v=vRsp-3m4WtE)

[7] Brainfpv. Drone Electronics. Good and well known shop. [Link](https://www.brainfpv.com/)

[8] Filters used to combine gyroscope and accelerometer. [Link](https://www.reddit.com/r/Quadcopter/comments/328a90/how_is_an_accelerometer_useful/)

[9] The Hypsometric Equation. [Link](https://en.wikipedia.org/wiki/Hypsometric_equation)

[10] Satellite World Map. [Link](https://in-the-sky.org/satmap_worldmap.php?year=2024&month=2&day=27)

[11] Extended Kalman Filter. [Link](https://mwrona.com/posts/attitude-ekf/)
